<!DOCTYPE html>
<html lang="pt-BR">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Escalonamento</title>
 <link rel="icon" type="image/png" href="icons/nt.png">
 <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
 <style>
 body {
 font-family: 'Poppins', sans-serif;
 background-color: #ff6f00;
 }
 .container {
 border: 2px solid #000;
 padding: 20px;
 max-width: 600px;
 margin: 0 auto;
 background-color: #f9f9f9;
 }
 .titulo {
 background-color: #ff6f00; /* Roxo */
 color: #fff; /* Branco */
 padding: 10px;
 text-align: center;
 font-size: 1.5em;
 margin-bottom: 20px;
 }
 .carimbo {
 border: 2px solid #000;
 padding: 10px;
 margin-top: 20px;
 display: none;
 
 }
 .carimboTitulo {
 background-color: #ff6f00; /* Roxo */
 color: #fff; /* Branco */
 padding: 10px;
 text-align: center;
 font-size: 1.2em;
 margin-bottom: 10px;
 }
 table {
 width: 100%;
 border-collapse: collapse;
 }
 table, th, td {
 border: 3px solid #d3d3d3; /* Linhas cinza claro e mais grossas */
 }
 th, td {
 padding: 8px;
 text-align: left;
 }
 th {
 background-color: #ff6f00; /* Roxo */
 color: #fff; /* Branco */
 }
 td {
 background-color: #fff; /* Branco */
 }
 textarea {
 width: 100%;
 height: 100px;
 }
 .botoes {
 margin-top: 20px;
 }
 .botoes button {
 margin-right: 10px;
 }

 .tabela-container-1 {
            width: 90vw;
            max-width: 100%;
            overflow-x: auto;
            border: 1px solid #d3d3d3;
            background: white;
            padding: 0px;
            margin-left: 0px;
            font-size: 9px;
            font-weight: bold;
        }

        .tabela-container-1 th {
        text-align: center; 
        vertical-align: middle; 
        }

        .tabela-container {
            width: 93vw;
            max-width: 100%;
            overflow-x: auto;
            border: 1px solid #d3d3d3;
            background: white;
            padding: 5px;
            margin-left: 90px;
        }
        textarea {
            width: 100%;
            height: 100px;
        }
        .botoes {
            margin-top: 9px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .botoes button {
            background-color: #ff6f00;
            color: #fff;
            border: none;
            padding: 6px 40px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }

        .botoes-1 {
            margin-top: 20px;
            margin-right: 10px;
        }
        .container-principal {
        background-color: #fff; /* Fundo branco */
        border-radius: 15px; /* Bordas arredondadas */
        padding: 20px; /* Espa√ßamento interno */
        margin: 20px auto; /* Centraliza o container */
        width: 90%; /* Largura responsiva */
        max-width: 1200px; /* Limita a largura m√°xima */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 1); /* Sombra suave */
        }



        .btn-salvar {
    background-color: #ff6f00;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 28px;
    font-size: 1.1em;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    transition: background 0.2s, transform 0.1s;
}
.btn-salvar:hover {
    background-color: #ff6f00;
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
}

.btn-excluir {
    background-color: #ff6f00;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 28px;
    font-size: 1.1em;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    transition: background 0.2s, transform 0.1s;
}
.btn-excluir:hover {
    background-color: #ff6f00;
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
}



.limparTabela {
    background-color: #ff6f00;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 28px;
    font-size: 1.1em;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    transition: background 0.2s, transform 0.1s;
}
.limparTabela:hover {
    background-color: #ff6f00;
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
}

.select-historico {
    width: 60%;
    padding: 8px 12px;
    border: 2px solid #ff6f00;
    border-radius: 8px;
    background: #fff;
    color: #333;
    font-size: 1em;
    font-family: 'Poppins', sans-serif;
    margin-top: 5px;
    margin-bottom: 10px;
    transition: border 0.2s;
}
.select-historico:focus {
    border-color: #ff6f00;
    outline: none;
    box-shadow: 0 0 0 2px #ff63474d;
}

.centralizado {
    text-align: center;
    margin-bottom: 20px;
}
.centralizado .btn-salvar,
.centralizado .select-historico {
    margin-left: auto;
    margin-right: auto;
    display: inline-block;
}
 </style>
</head>
<body>

  <div class="container-principal">
  <div class="tabela-container-1">
    <table id="tabela">
        <thead>
            <tr>
                <th style="width: 90px;">TA METRO</th>
                <th style="width: 70px;">DWDM LINHA</th>
                <th style="width: 70px;">TA RAIZ (REDE)</th>
                <th style="width: 100px;">LOCALIDADE</th>
                <th style="width: 100px;">ROTA</th>
                <th style="width: 100px;">DATA ALARME</th>
                <th style="width: 120px;">TEMPO CORRIDO</th>
                <th style="width: 100px;">HL4</th>
                <th style="width: 120px;">RISCO OLT</th>
                <th style="width: 90px;">RISCO FTTX</th>
                <th style="width: 90px;">RISCO ADSL</th>
                <th style="width: 130px;">AFETA√á√ÉO ERB</th>
                <th style="width: 120px;">TOTAL RISCO</th>
                <th style="width: 120px;">AFETA√á√ÉO FTTX</th>
                <th style="width: 90px;">AFETA√á√ÉO ADSL</th>
                <th style="width: 90px;">AFETA√á√ÉO TOTAL</th>
                <th style="width: 130px;">RESUMO STATUS</th>
                <th style="width: 120px;">AREA RESPONSAVEL</th>
                <th style="width: 90px;">EVENTOS ENVOLVIDOS</th>
                <th style="width: 90px;">TECNOLOGIA</th>
                <th style="width: 130px;">TTMC</th>
                <th style="width: 120px;">ADJ, SPC</th>
                </tr>
        </thead>
        <tbody id="tabela-body"></tbody>
    </table>
</div>

<div class="botoes">
</div>


<div class="centralizado">
    <label for="historico"></label>
    <select id="historico" class="select-historico" onchange="carregarFormularioSelecionado()">
        <option value="" hidden style="text-align: center;">-- Selecione um evento --</option>
    </select><br> 
  
    <button type="button" class="btn-salvar" onclick="salvarFormulario()">üíæ Salvar</button>
    <button class="limparTabela">üóëÔ∏è Limpar</button>
    <button type="button" class="btn-excluir" onclick="excluirEventoSelecionado()">‚ùå Excluir Evento</button>
  
    <br>
  </div>
  



 <div class="container">
 <div class="titulo">NT-SPI üå°Ô∏è Escalonamentos üå°Ô∏è</div>
 <h1>Formul√°rio</h1>
 <form id="meuFormulario">

  <label for="escalonamento">Escalonamento:</label>
  <select id="escalonamento" name="escalonamento" required>
    <option value="" hidden>SELECIONAR O TIPO</option>
    <option value="OLT-LINK">OLT-LINK</option>
  <option value="INFRA">INFRA</option>
   <option value="OLT-DOWN">OLT-DOWN</option>
   <option value="DRACO">DRACO</option>
   <option value="DWDM">DWDM</option>
   <option value="METRO">METRO</option>
   <option value="M√ìVEL">M√ìVEL</option>
  <option value="ADJAC√äNCIA">ADJANC√äNCIA</option>
  <option value="BBN">BBN</option>
  <option value="CONDOM√çNIO PLANTA INTERNA">CONDOM√çNIO PLANTA INTERNA</option>
  <option value="DWDM IMPACTO HL4">DWDM IMPACTO HL4</option>
  <option value="DWDM IMPACTO HL3">DWDM IMPACTO HL3</option>
 </select><br><br>
 
 <label for="municipio">Municipio:</label>
 <input type="text" id="municipio" name="municipio" required><br><br>
 
 <label for="ta">TA:</label>
 <input type="text" id="ta" name="ta" required><br><br>
 
 <label for="dataAbertura">Data Abertura:</label>
 <input type="datetime-local" id="dataAbertura" name="dataAbertura" required><br><br>
 
 <label for="taRaiz">TA Raiz:</label>
 <input type="text" id="taRaiz" name="taRaiz" required><br><br>

 <label for="taRaiz">OLT's em Risco:</label>
 <input type="number" id="oltris" name="oltris" required><br><br>

  <label for="pontaA">Ponta A:</label>
 <input type="text" id="pontaa" name="pontaa"><br><br>

  <label for="pontaB">Ponta B:</label>
 <input type="text" id="pontab" name="pontab"><br><br>

  <label for="cabo">Cabo:</label>
 <input type="number" id="cabo" name="cabo"><br><br>

 <div id="campoCaboConcorrente" style="display:none; margin-bottom: 20px; align-items: center;">
  <label for="caboConcorrente" style="margin-right: 10px;">Cabo Concorrente:</label>
  <input type="text" id="caboConcorrente" name="caboConcorrente" style="width: 150px;">
</div>

 <label for="gestorAtual">Gestor Atual:</label>
<select id="gestorAtual" name="gestorAtual" required>
  <option value="" hidden>SELECIONAR</option>
  <option value="N1 - ABILITY">N1 - ABILITY</option>
  <option value="N1 - TEL">N1 - TEL</option>
  <option value="N1 - SUL">N1 - SUL</option>
  <option value="REDE - SUL">REDE - SUL</option>
  <option value="REDE - TEL">REDE - TEL</option>
  <option value="REDE - ICOMON">REDE - ICOMON</option>
  <option value="NOC">NOC</option>
  <option value="N2">N2</option>
  <option value="O&M ACESSO VIVO_N1_SPI">O&M ACESSO VIVO_N1_SPI</option>
  <option value="SUPORTE">SUPORTE</option>
  <option value="SWAP">SWAP</option>
  <option value="CO-N1">CO-N1</option>
  <option value="SOBRESSALENTE CHAMADO INTERNO">SOBRESSALENTE INTERNO</option>
  <option value="SOBRESSALENTE FORNECEDOR">SOBRESSALENTE FORNECEDOR</option>
  <option value="OPERACAO RF">OPERACAO RF</option>
  <option value="OPERACAO MOVEL BACKHAUL">OPERACAO MOVEL BACKHAUL</option>
  <option value="OPERA√á√ÉO BANDA LARGA">OPERA√á√ÉO BANDA LARGA</option>
  <option value="OPERA√á√ÉO DWDM">OPERA√á√ÉO DWDM</option>
  <option value="OPERA√á√ÉO REDE IP">OPERA√á√ÉO REDE IP</option>
  <option value="N1 CAPITAL">N1 CAPITAL</option>
  <option value="N1 SUDESTE">N1 SUDESTE</option>
  <option value="REDE SUDESTE">REDE SUDESTE</option>
  <option value="REDE CAPITAL">REDE CAPITAL</option>
<option value="BACKBONE TX OPERA√á√ÉO">BACKBONE TX OPERA√á√ÉO</option>
</select><br><br>


<label for="tempoNoc">Tempo NOC (horas):</label>
<input type="text" id="tempoNoc" name="tempoNoc" required pattern="^[0-9]+:[0-5][0-9]$" placeholder="HH:MM"><br><br>

<label for="tempoN1">Tempo N1 (horas):</label>
<input type="text" id="tempoN1" name="tempoN1" required pattern="^[0-9]+:[0-5][0-9]$" placeholder="HH:MM"><br><br>

<label for="tempoRede">Tempo Rede (horas):</label>
<input type="text" id="tempoRede" name="tempoRede" required pattern="^[0-9]+:[0-5][0-9]$" placeholder="HH:MM"><br><br>

<!-- Campo para selecionar "Outro" -->
<label for="outroTipo">Outro:</label>
<input type="checkbox" id="outroTipo" name="outroTipo" onclick="toggleOutroOptions()">
<br><br>

<div id="outroOptions" style="display: none;">
    <label for="outrosOPP"></label>
    <select id="outrosOPP" name="outrosOPP" onchange="atualizarTituloTempoOutro()">
      <option value="" hidden>Outros</option>
      <option value="N2">N2</option>
      <option value="N1 - SUL">N1 - SUL</option>
      <option value="REDE - SUL">REDE - SUL</option>
      <option value="SUPORTE">SUPORTE</option>
      <option value="SWAP">SWAP</option>
      <option value="CO-N1">CO-N1</option>
      <option value="SOBRESSALENTE CHAMADO INTERNO">SOBRESSALENTE INTERNO</option>
      <option value="SOBRESSALENTE FORNECEDOR">SOBRESSALENTE FORNECEDOR</option>
      <option value="OPERACAO RF">OPERACAO RF</option>
      <option value="OPERACAO MOVEL BACKHAUL">OPERACAO MOVEL BACKHAUL</option>
      <option value="OPERA√á√ÉO BANDA LARGA">OPERA√á√ÉO BANDA LARGA</option>
      <option value="OPERA√á√ÉO DWDM">OPERA√á√ÉO DWDM</option>
      <option value="OPERA√á√ÉO REDE IP">OPERA√á√ÉO REDE IP</option>
      <option value="N1 CAPITAL">N1 CAPITAL</option>
      <option value="N1 SUDESTE">N1 SUDESTE</option>
      <option value="REDE SUDESTE">REDE SUDESTE</option>
      <option value="REDE CAPITAL">REDE CAPITAL</option>
    </select>
    <input type="text" id="tempoOutro" name="tempoOutro" pattern="^[0-9]+:[0-5][0-9]$" placeholder="HH:MM"><br><br>
  </div>
  
  <label for="nivel">N√≠vel:</label>
  <select id="nivel" name="nivel" required>
    <option value="" hidden>SELECIONAR</option>
    <option value="COORDENADOR">COORDENADOR</option>
    <option value="GERENTE">GERENTE</option>
    <option value="SENIOR">SENIOR</option>
    <option value="DIRETOR">DIRETOR</option>
  </select><br><br>
  
  <label for="status">Status:</label>
  <textarea id="status" name="status" required></textarea><br><br>
  
  <input type="hidden" id="envio" name="envio" value="">
  <button type="submit">Enviar</button>
  
  <div class="carimbo" id="carimbo">
    <div class="carimboTitulo">NT-SPI üå°Ô∏è Escalonamentos üå°Ô∏è</div>
    <table>
      <tr>
        <th>Descri√ß√£o</th>
        <th>Atualiza√ß√£o</th>
      </tr>
      <tr>
        <td>Escalonamento</td>
        <td><span id="carimboEscalonamento"></span></td>
      </tr>
      <tr>
        <td>Municipio</td>
        <td><span id="carimboMunicipio"></span></td>
      </tr>
      <tr>
        <td>TA</td>
        <td><span id="carimboTA"></span></td>
      </tr>
      <tr>
        <td>Data Abertura</td>
        <td><span id="carimboDataAbertura"></span></td>
      </tr>
      <tr>
        <td>TA Raiz</td>
        <td><span id="carimboTARaiz"></span></td>
      </tr>
      <tr>
        <td>OLT's em Risco</td>
        <td><span id="carimbooltris"></span></td>
      </tr>
      <tr>
        <td>Ponta A/B e Cabo</td>
        <td><span id="carimbopontABC"></span></td>
      </tr>
      <tr id="linhaCaboConcorrente" style="display: none;">
        <td>Cabo Concorrente</td>
        <td><span id="carimboCaboConcorrente"></span></td>
    </tr>
      <tr>
        <td>Gestor Atual</td>
        <td><span id="carimboGestorAtual"></span></td>
      </tr>
      <tr>
        <td>Tempo NOC</td>
        <td><span id="carimboTempoNoc"></span></td>
      </tr>
      <tr>
        <td>Tempo N1</td>
        <td><span id="carimboTempoN1"></span></td>
      </tr>
      <tr>
        <td>Tempo Rede</td>
        <td><span id="carimboTempoRede"></span></td>
      </tr>
      <tr>
        <td>Tempo Total (NOC, N1, Rede)</td>
        <td><span id="carimboTempoTotal"></span></td>
      </tr>
      <tr id="outroRow" style="display: none;">
        <td id="tituloTempoOutro">Tempo Outros</td>
        <td><span id="carimboTempoOutro"></span></td>
      </tr>
      <tr>
        <td>N√≠vel</td>
        <td><span id="carimboNivel"></span></td>
      </tr>
      <tr>
        <td>Status</td>
        <td><span id="carimboStatus"></span></td>
      </tr>
      <tr>
        <td>Envio</td>
        <td><span id="carimboEnvio"></span></td>
      </tr>
      <tr>
        <td>Tempo TA</td>
        <td><span id="carimboTempoTA"></span></td>
      </tr>
    </table>
    <div class="botoes">
      <button id="voltar">Voltar</button>
    </div>
  </div>
</div>



<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyB3RcO5CLTdElfKWs-9NRYZK3bYQOaZjvY",
  authDomain: "gestao-uplink-down.firebaseapp.com",
  databaseURL: "https://gestao-uplink-down-default-rtdb.firebaseio.com",
  projectId: "gestao-uplink-down",
  storageBucket: "gestao-uplink-down.firebasestorage.app",
  messagingSenderId: "44245495345",
  appId: "1:44245495345:web:00b6647e40241b6f47af10",
  measurementId: "G-9267XD7E6T"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>


<script>



function salvarFormulario() {
    const ta = document.getElementById('ta').value;

    if (!ta) {
        alert("Informe a TA para salvar.");
        return;
    }

    const chave = ta;
    const statusAtual = document.getElementById('status').value;
    const timestamp = obterDataHoraAtual();

    const dados = {
        escalonamento: document.getElementById('escalonamento').value,
        municipio: document.getElementById('municipio').value,
        ta: ta,
        dataAbertura: document.getElementById('dataAbertura').value,
        taRaiz: document.getElementById('taRaiz').value,
        oltris: document.getElementById('oltris').value,
        pontaa: document.getElementById('pontaa').value,
        pontab: document.getElementById('pontab').value,
        cabo: document.getElementById('cabo').value,
        caboConcorrente: document.getElementById('caboConcorrente').value,
        gestorAtual: document.getElementById('gestorAtual').value,
        tempoNoc: document.getElementById('tempoNoc').value,
        tempoN1: document.getElementById('tempoN1').value,
        tempoRede: document.getElementById('tempoRede').value,
        outroTipo: document.getElementById('outroTipo').checked,
        outrosOPP: document.getElementById('outrosOPP').value,
        tempoOutro: document.getElementById('tempoOutro').value,
        nivel: document.getElementById('nivel').value,
        status: statusAtual
    };

    const ref = firebase.database().ref('escalonamento/' + chave);

    ref.once('value', function(snapshot) {
        const historicoStatus = snapshot.val()?.historicoStatus || [];
        historicoStatus.push(`${timestamp} - ${statusAtual}`);
        dados.historicoStatus = historicoStatus;

        if (!snapshot.exists()) {
            dados.statusEvento = "Ativo";
        }

        ref.update(dados, function(error) {
            if (error) {
                alert("Erro ao salvar: " + error);
            } else {
                alert(snapshot.exists() ? "Evento atualizado com sucesso!" : "Novo evento salvo com sucesso!");
                atualizarDropdown(chave);
            }
        });
    });
}


function obterDataHoraAtual() {
    const agora = new Date();
    const dia = String(agora.getDate()).padStart(2, '0');
    const mes = String(agora.getMonth() + 1).padStart(2, '0');
    const ano = agora.getFullYear();
    const horas = String(agora.getHours()).padStart(2, '0');
    const minutos = String(agora.getMinutes()).padStart(2, '0');
    return `${dia}/${mes}/${ano} ${horas}:${minutos}`;
}



function atualizarDropdown(selecionarTA = '') {
    const dropdown = document.getElementById('historico');
    dropdown.innerHTML = '<option value="" hidden style="text-align: center;">-- Selecione um evento --</option>';

    firebase.database().ref('escalonamento').once('value', function(snapshot) {
        snapshot.forEach(function(child) {
            const ta = child.key;
            const data = child.val();

            if (data.statusEvento === "Ativo") {
                const municipio = data.municipio || '';
                const option = document.createElement('option');
                option.value = ta;
                option.textContent = municipio ? `${ta} - ${municipio}` : ta;

                if (ta === selecionarTA) {
                    option.selected = true;
                    carregarFormularioSelecionado();
                }

                dropdown.appendChild(option);
            }
        });
    });
}


function excluirEventoSelecionado() {
    const taSelecionado = document.getElementById('historico').value;
    if (!taSelecionado) {
        alert("Selecione um evento para encerrar.");
        return;
    }

    if (confirm(`Tem certeza que deseja encerrar o evento ${taSelecionado}?`)) {
        firebase.database().ref('escalonamento/' + taSelecionado).update({
            statusEvento: "Encerrado"
        })
        .then(() => {
            alert(`Evento ${taSelecionado} encerrado com sucesso.`);
            atualizarDropdown();
        })
        .catch(error => {
            alert("Erro ao encerrar: " + error);
        });
    }
}


function carregarFormularioSelecionado() {
    const chave = document.getElementById('historico').value;
    if (!chave) return;

    firebase.database().ref('escalonamento/' + chave).once('value', function(snapshot) {
        const data = snapshot.val();
        if (data) {
            document.getElementById('escalonamento').value = data.escalonamento || '';
            document.getElementById('municipio').value = data.municipio || '';
            document.getElementById('ta').value = data.ta || '';
            document.getElementById('dataAbertura').value = data.dataAbertura || '';
            document.getElementById('taRaiz').value = data.taRaiz || '';
            document.getElementById('oltris').value = data.oltris || '';
            document.getElementById('pontaa').value = data.pontaa || '';
            document.getElementById('pontab').value = data.pontab || '';
            document.getElementById('cabo').value = data.cabo || '';
            document.getElementById('caboConcorrente').value = data.caboConcorrente || '';
            document.getElementById('gestorAtual').value = data.gestorAtual || '';
            document.getElementById('tempoNoc').value = data.tempoNoc || '';
            document.getElementById('tempoN1').value = data.tempoN1 || '';
            document.getElementById('tempoRede').value = data.tempoRede || '';
            document.getElementById('outroTipo').checked = data.outroTipo || false;
            document.getElementById('outrosOPP').value = data.outrosOPP || '';
            document.getElementById('tempoOutro').value = data.tempoOutro || '';
            document.getElementById('nivel').value = data.nivel || '';

            const historicoStatus = data.historicoStatus || [];
            const ultimoStatus = historicoStatus.length > 0
                ? historicoStatus[historicoStatus.length - 1].split(' - ').slice(1).join(' - ')
                : '';
            document.getElementById('status').value = ultimoStatus;

            const escalonamentoSelect = document.getElementById('escalonamento');
            escalonamentoSelect.dispatchEvent(new Event('change'));
        }
    });
}




window.onload = function() {
    atualizarDropdown();
};

document.addEventListener("DOMContentLoaded", function () {
    const escalonamentoSelect = document.getElementById("escalonamento");
    const tituloElement = document.querySelector(".titulo");
    const carimboTitulo = document.querySelector(".carimboTitulo");
    const botoes = document.querySelectorAll(".botoes button");
    const ths = document.querySelectorAll("th");
    const container = document.querySelector(".container");
    const carimboBox = document.getElementById("carimbo");

    // Novos elementos da div centralizado
    const historicoSelect = document.getElementById("historico");
    const btnSalvar = document.querySelector(".btn-salvar");
    const btnExcluir = document.querySelector(".btn-excluir");
    const btnLimpar = document.querySelector(".limparTabela");

    const COR_PADRAO = "#ff6f00";
    const COR_CRITICA = "#b30000"; // HL4
    const COR_HL3 = "#494949"; // HL3
    const FUNDO_CONTAINER_CRITICO = "#ffeaea";
    const FUNDO_CONTAINER_HL3 = "#E2E2E2";
    const FUNDO_CONTAINER_NORMAL = "#f9f9f9";
    const FUNDO_CARIMBO_NORMAL = "#ffffff";

    const TITULO_PADRAO = "NT-SPI üå°Ô∏è Escalonamentos üå°Ô∏è";
    const TITULO_CRITICO = 'NT - SPI <img src="icons/icone_HL4.png" style="height:20px; vertical-align:middle;"> DWDM IMPACTO HL4/HL3 <img src="icons/icone_HL4.png" style="height:20px; vertical-align:middle;">';
    const TITULO_HL3 = 'NT - SPI <img src="icons/icone_HL3.png" style="height:20px; vertical-align:middle;"> DWDM IMPACTO HL3/HL2 <img src="icons/icone_HL3.png" style="height:20px; vertical-align:middle;">';

    escalonamentoSelect.addEventListener("change", function () {
        const isHL4 = this.value === "DWDM IMPACTO HL4";
        const isHL3 = this.value === "DWDM IMPACTO HL3";
        const corAtual = isHL4 ? COR_CRITICA : isHL3 ? COR_HL3 : COR_PADRAO;

        // Fundo geral da p√°gina
        document.body.style.backgroundColor = corAtual;

        // Bot√µes
        botoes.forEach(btn => {
            btn.style.backgroundColor = corAtual;
        });

        // Cabe√ßalhos da tabela
        ths.forEach(th => {
            th.style.backgroundColor = corAtual;
        });

        // Container do formul√°rio
        if (container) {
            container.style.backgroundColor = isHL4 ? FUNDO_CONTAINER_CRITICO : isHL3 ? FUNDO_CONTAINER_HL3 : FUNDO_CONTAINER_NORMAL;
        }

        // Container do carimbo
        if (carimboBox) {
            carimboBox.style.backgroundColor = isHL4 ? FUNDO_CONTAINER_CRITICO : isHL3 ? FUNDO_CONTAINER_HL3 : FUNDO_CARIMBO_NORMAL;
        }

        // T√≠tulo do formul√°rio
        if (tituloElement) {
            tituloElement.innerHTML = isHL4 ? TITULO_CRITICO : isHL3 ? TITULO_HL3 : TITULO_PADRAO;
            tituloElement.style.backgroundColor = corAtual;
        }

        // T√≠tulo do carimbo
        if (carimboTitulo) {
            carimboTitulo.innerHTML = isHL4 ? TITULO_CRITICO : isHL3 ? TITULO_HL3 : TITULO_PADRAO;
            carimboTitulo.style.backgroundColor = corAtual;
        }

        // Mostrar/ocultar campo Cabo Concorrente no formul√°rio e definir required
        const campoCaboConcorrente = document.getElementById("campoCaboConcorrente");
        const inputCaboConcorrente = document.getElementById("caboConcorrente");
        if (isHL4) {
            campoCaboConcorrente.style.display = "flex";
            inputCaboConcorrente.required = true;
        } else {
            campoCaboConcorrente.style.display = "none";
            inputCaboConcorrente.required = false;
            inputCaboConcorrente.value = "";
        }

        // Bloquear N√≠vel = DIRETOR no HL3
        const nivelSelect = document.getElementById("nivel");
        if (isHL3) {
            nivelSelect.value = "DIRETOR";
            nivelSelect.disabled = true;
        } else {
            nivelSelect.disabled = false;
        }

        // Estilizar elementos da div centralizado

        if (historicoSelect) historicoSelect.style.borderColor = corAtual;
        if (btnSalvar) btnSalvar.style.backgroundColor = corAtual;
        if (btnExcluir) btnExcluir.style.backgroundColor = corAtual;
        if (btnLimpar) btnLimpar.style.backgroundColor = corAtual;
    });
});





  </script>
 <script>
let cachedJson = null; // Cache variable for JSON data


function calcularOltsEmRisco(hl4Str) {
    if (!hl4Str) {
        document.getElementById("oltris").value = "";
        return;
    }
 
    // Extrai HL4s (separadores: espa√ßo, \n, , ou ;)
    const hl4List = hl4Str
        .replace(/^"+|"+$/g, "")               // tira aspas iniciais/finais
        .split(/\s+|,|;/)                      // quebra por espa√ßos/virgula/;
        .map(s => s.trim().toUpperCase())
        .filter(item => item.length && item.startsWith("I-"));
 
    // Remove duplicados da c√©lula
    const uniqueHl4 = [...new Set(hl4List)];
    console.log("HL4 extra√≠dos (√∫nicos):", uniqueHl4);
 
    const processJson = (json) => {
        // Criar √≠ndice: NOME_REDE_SWD (normalizado) -> qtd OLT (usar maior se houver duplicatas)
        const index = {};
        json.forEach(item => {
            if (!item || !item["NOME_REDE_SWD"]) return;
            const key = String(item["NOME_REDE_SWD"]).trim().toUpperCase();
            // tenta pegar o campo OLT por HL4 de forma resiliente
            let raw = item["OLT por HL4"] ?? item["OLT_por_HL4"] ?? item["OLT"] ?? "0";
            let qtd = parseInt(String(raw).replace(/[^\d-]/g, ""), 10);
            if (isNaN(qtd)) qtd = 0;
 
            if (index[key] === undefined) {
                index[key] = qtd;
            } else if (qtd > index[key]) {
                // se repetir, mant√©m o maior (evita undercount se dados inconsistentes)
                console.warn(`Duplicata no JSON para ${key}: mantendo maior ${qtd} (antes ${index[key]})`);
                index[key] = qtd;
            }
        });
 
        // Soma usando o √≠ndice (cada HL4 contado apenas 1 vez)
        let soma = 0;
        uniqueHl4.forEach(hl4Item => {
            if (index[hl4Item] !== undefined) {
                soma += index[hl4Item];
                console.log(`HL4 ${hl4Item} -> ${index[hl4Item]} OLT(s)`);
            } else {
                console.warn(`HL4 ${hl4Item} N√ÉO encontrado no JSON`);
            }
        });
 
        document.getElementById("oltris").value = soma;
    };
 
    if (cachedJson) {
        processJson(cachedJson);
    } else {
fetch("https://grupotel-web.github.io/dadosOLT.json")
            .then(resp => resp.json())
            .then(json => {
                cachedJson = json;
                processJson(json);
            })
            .catch(err => {
                console.error("Erro fetch dadosOLT.json:", err);
                document.getElementById("oltris").value = "";
            });
    }
}

document.addEventListener("DOMContentLoaded", function () {
    function preencherFormulario() {
        let tabela = document.querySelector("table");
        if (!tabela) return;

        let linhas = tabela.querySelectorAll("tbody tr");
        if (linhas.length === 0) return;

        let ultimaLinha = linhas[linhas.length - 1];
        let colunas = ultimaLinha.querySelectorAll("td");

        if (colunas.length < 9) return; // Garante que tem colunas suficientes antes de preencher

        let ta = colunas[1].textContent.trim(); // Coluna DWDM LINHA
        let taRaiz = colunas[2].textContent.trim(); // Coluna TA RAIZ (REDE)
        let dataAbertura = colunas[5].textContent.trim(); // Coluna DATA ALARME
        let municipioCompleto = colunas[3].textContent.trim(); // Coluna LOCALIDADE (Munic√≠pio)
        let hl4 = colunas[7].textContent.trim(); // Coluna HL4

        // Pegando apenas o que vem antes do "-" no munic√≠pio
        let municipio = municipioCompleto.split("-")[0].trim();

        // Preenchendo os campos do formul√°rio
        document.getElementById("ta").value = ta;
        document.getElementById("taRaiz").value = taRaiz;
        document.getElementById("dataAbertura").value = formatarData(dataAbertura);
        document.getElementById("municipio").value = municipio;

        // Buscar e somar OLT por HL4
        calcularOltsEmRisco(hl4);
    }

    function formatarData(data) {
        if (!data) return "";
        let partes = data.split(" ");
        if (partes.length < 2) return "";

        let [dia, mes, ano] = partes[0].split("/");
        let horario = partes[1];

        return `${ano}-${mes}-${dia}T${horario}`;
    }

    let observer = new MutationObserver(preencherFormulario);
    let tabela = document.querySelector("table");

    if (tabela) {
        observer.observe(tabela, { childList: true, subtree: true });
    }
});

function criarLinha(celulas = 22, valores = []) {
            let tabela = document.getElementById("tabela-body");
            let novaLinha = tabela.rows[0];

            if (novaLinha) {
                for (let i = 0; i < celulas; i++) {
                    novaLinha.cells[i].textContent = valores[i] || "";
                }
            } else {
                novaLinha = tabela.insertRow();
                for (let i = 0; i < celulas; i++) {
                    let celula = novaLinha.insertCell();
                    celula.contentEditable = "true";
                    celula.textContent = valores[i] || "";
                }
            }
        }

        function inicializarTabela(linhas = 1) {
            let tabela = document.getElementById("tabela-body");
            tabela.innerHTML = "";
            for (let i = 0; i < linhas; i++) {
                criarLinha();
            }
        }

        document.addEventListener("paste", function(event) {
    let target = event.target;
    if (target.tagName.toLowerCase() === 'td') {
        event.preventDefault();
        let pasteData = event.clipboardData.getData("text");

        // Substituir quebras de linha dentro de c√©lulas por espa√ßo para evitar divis√£o incorreta
        pasteData = pasteData.replace(/([^\t])\n([^\t])/g, "$1 $2");

        let linhas = pasteData.split("\n").filter(linha => linha.trim() !== "");
        let tabela = target.closest("table"); // Pega a tabela mais pr√≥xima
        let ultimaLinhaIndex = target.parentNode.rowIndex; // Obt√©m o √≠ndice da linha onde come√ßou a colagem

        linhas.forEach((linha, linhaIndex) => {
            let colunas = linha.split("\t");
            let linhaTabela = tabela.rows[ultimaLinhaIndex];

            if (linhaTabela) {
                if (linhaIndex === 0) {
                    // Primeira linha: Preencher normalmente
                    colunas.forEach((valor, colunaIndex) => {
                        let celula = linhaTabela.cells[colunaIndex];
                        if (celula) {
                            celula.innerText = valor;
                        }
                    });
                } else {
                    // Segunda linha: Adicionar os dados na pr√≥xima c√©lula vazia da linha principal
                    let ultimaCelulaIndex = [...linhaTabela.cells].findIndex(celula => celula.innerText.trim() === "");
                    let celulaDestino = linhaTabela.cells[ultimaCelulaIndex] || linhaTabela.insertCell(-1);
                    celulaDestino.innerText = colunas.join(" "); // Junta tudo para evitar separa√ß√£o errada
                }
            }
        });
    }
});



        function limparTabela() {
            inicializarTabela();
        }

        // Associar o evento de clique no bot√£o "Limpar"
        document.querySelector(".limparTabela").addEventListener("click", limparTabela);

        inicializarTabela();


function atualizarTituloTempoOutro() {
    const outrosOPP = document.getElementById("outrosOPP").value;
    const titulo = document.getElementById("tituloTempoOutro");

    if (escalonamento) {
      titulo.innerText = `Tempo Outros (${outrosOPP})`;
    } else {
      titulo.innerText = "Tempo Outros"; // Caso n√£o tenha nada selecionado
    }
  }

function toggleOutroOptions() {
    var outroDiv = document.getElementById("outroOptions");
    var outroCheckBox = document.getElementById("outroTipo");
    
    if (outroCheckBox.checked) {
        outroDiv.style.display = "block";
        document.getElementById("outroRow").style.display = "table-row"; // Mostra a linha de 'Tempo Outros'
        document.getElementById("carimboTempoOutro").innerText = document.getElementById("tempoOutro").value; // Adiciona o tempo do outro
    } else {
        outroDiv.style.display = "none";
        document.getElementById("outroRow").style.display = "none"; // Oculta a linha de 'Tempo Outros'
        document.getElementById("carimboTempoOutro").innerText = ''; // Limpa o campo
    }
}

 
 document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("input[type='text'][name^='tempo']").forEach(input => {
        input.addEventListener("input", function (event) {
            let value = this.value.replace(/[^0-9]/g, ""); // Remove caracteres n√£o num√©ricos

            // Limitar o valor a no m√°ximo 6 caracteres
            if (value.length > 5) {
                value = value.slice(0, 5);
            }

            if (value.length > 3) {
                let horas = value.slice(0, value.length - 2); // Tudo antes dos √∫ltimos 2 d√≠gitos
                let minutos = value.slice(-2); // √öltimos 2 d√≠gitos

                // Ajusta os minutos para 59 se for maior que 59
                if (parseInt(minutos) > 59) {
                    minutos = "59";
                }

                this.value = `${horas}:${minutos}`;
            } else {
                this.value = value;
            }
        });
    });
});
 document.getElementById('meuFormulario').addEventListener('submit', function(event) {
 event.preventDefault();
 var escalonamento = document.getElementById('escalonamento').value;
 var municipio = document.getElementById('municipio').value;
 var ta = document.getElementById('ta').value;
 var dataAbertura = document.getElementById('dataAbertura').value;
 var taRaiz = document.getElementById('taRaiz').value;
 var oltris = document.getElementById('oltris').value;

 var pontaa = document.getElementById('pontaa').value;
 var pontab = document.getElementById('pontab').value;
 var cabo = document.getElementById('cabo').value;

 var gestorAtual = document.getElementById('gestorAtual').value;
 var tempoNoc = document.getElementById('tempoNoc').value;
 var tempoN1 = document.getElementById('tempoN1').value;
 var tempoRede = document.getElementById('tempoRede').value;
 var tempoOutro = document.getElementById('tempoOutro').value;
 var tempoTotal = calcularTempoTotal(tempoNoc, tempoN1, tempoRede);
 var nivel = document.getElementById('nivel').value;
 var status = document.getElementById('status').value;
 var envio = new Date().toISOString();
 var envioFormatado = formatarDataHora(envio);
 var tempoTA = calcularTempoTA(dataAbertura, envio);

 function formatarDataHora(dataHora) {
   if (!dataHora) return '';
   var data = new Date(dataHora);
   var dia = String(data.getDate()).padStart(2, '0');
   var mes = String(data.getMonth() + 1).padStart(2, '0');
   var ano = data.getFullYear();
   var horas = String(data.getHours()).padStart(2, '0');
   var minutos = String(data.getMinutes()).padStart(2, '0');
   return `${dia}/${mes}/${ano} ${horas}:${minutos}`;
 }

 function calcularTempoTotal(tempoNoc, tempoN1, tempoRede) {
   var [horasNoc, minutosNoc] = tempoNoc.split(':').map(Number);
   var [horasN1, minutosN1] = tempoN1.split(':').map(Number);
   var [horasRede, minutosRede] = tempoRede.split(':').map(Number);
   var totalMinutos = (horasNoc * 60 + minutosNoc) + (horasN1 * 60 + minutosN1) + (horasRede * 60 + minutosRede);
   var totalHoras = Math.floor(totalMinutos / 60);
   var totalMinutosRestantes = totalMinutos % 60;
   return `${String(totalHoras).padStart(2, '0')}:${String(totalMinutosRestantes).padStart(2, '0')}`;
 }

 function calcularTempoTA(dataAbertura, envio) {
   var dataAberturaDate = new Date(dataAbertura);
   var envioDate = new Date(envio);
   var diffMs = envioDate - dataAberturaDate;
   var diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
   var diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
   return `${String(diffHrs).padStart(2, '0')}:${String(diffMins).padStart(2, '0')}`;
 }


 

 document.getElementById('carimboEscalonamento').textContent = escalonamento;
 document.getElementById('carimboMunicipio').textContent = municipio;
 document.getElementById('carimboTA').textContent = ta;
 document.getElementById('carimboDataAbertura').textContent = formatarDataHora(dataAbertura);
 document.getElementById('carimboTARaiz').textContent = taRaiz;
 document.getElementById('carimbooltris').textContent = oltris;

 const rotasPlanoQueimadas = [
  { "Ponta A": "BRH.GV", "Ponta B": "PTG.PT", "CABO": "283" },
  { "Ponta A": "SRR.VS", "Ponta B": "BRS.BR", "CABO": "42" },
  { "Ponta A": "ARQ.FI", "Ponta B": "PTG.PT", "CABO": "220" },
  { "Ponta A": "LUDS.LD", "Ponta B": "NLZ.TM", "CABO": "247" },
  { "Ponta A": "POR.LE", "Ponta B": "ARQ.FI", "CABO": "290" },
  { "Ponta A": "CTD.RB", "Ponta B": "SRR.VS", "CABO": "84" },
  { "Ponta A": "IPV.SM", "Ponta B": "RFA.CP", "CABO": "274" },
  { "Ponta A": "ARQ.FI", "Ponta B": "SCL.AE", "CABO": "230" },
  { "Ponta A": "IIN.IP", "Ponta B": "SCL.AE", "CABO": "240" }
];

// Suponha que a vari√°vel 'cabo' j√° esteja definida
const rotaMatch = rotasPlanoQueimadas.find(rota => rota["CABO"] === cabo);

let textoRota = `${pontaa} / ${pontab} / ${cabo}`;
if (rotaMatch) {
  textoRota += `<br><span style="color: red; font-weight: bold;">‚ö†Ô∏è Aten√ß√£o! ‚ö†Ô∏è</span><br><span style="color: red; font-weight: bold;">Rota faz parte do plano queimadas!</span>`;
}

document.getElementById('carimbopontABC').innerHTML = textoRota;

// Cabo Concorrente no carimbo (apenas se HL4)
if (escalonamento === "DWDM IMPACTO HL4") {
    document.getElementById("carimboCaboConcorrente").textContent = document.getElementById("caboConcorrente").value;
    document.getElementById("linhaCaboConcorrente").style.display = "table-row";
} else {
    document.getElementById("linhaCaboConcorrente").style.display = "none";
}


 document.getElementById('carimboGestorAtual').textContent = gestorAtual;
 document.getElementById('carimboTempoNoc').textContent = tempoNoc;
 document.getElementById('carimboTempoN1').textContent = tempoN1;
 document.getElementById('carimboTempoRede').textContent = tempoRede;
 document.getElementById('carimboTempoOutro').textContent = tempoOutro;
 document.getElementById('carimboTempoTotal').textContent = tempoTotal;
 document.getElementById('carimboNivel').textContent = nivel;
 document.getElementById('carimboStatus').textContent = status;
 document.getElementById('carimboEnvio').textContent = envioFormatado;
 document.getElementById('carimboTempoTA').textContent = tempoTA;
 document.getElementById('carimbo').style.display = 'block';
});

document.getElementById('voltar').addEventListener('click', function() {
 document.getElementById('carimbo').style.display = 'none';
 document.getElementById('meuFormulario').reset();
});
</script>
</body>
</html>

<div class="sair">
  <img src="icons/HP.png" alt="√çcone de Porta" class="icone-porta">
  <span>Sair</span>
</div>

<style>
  .sair {
      position: fixed;
      top: 10px;
      left: 10px;
      display: flex;
      align-items: center;
      cursor: pointer;
      z-index: 9999; /* Fica sempre no topo */
      background-color: rgba(255, 255, 255, 0.8); /* Fundo branco com leve transpar√™ncia */
      padding: 5px;
      border-radius: 8px;
  }

  .icone-porta {
      width: 30px;
      height: 30px;
      margin-right: 5px;
  }

  .sair span {
      font-size: 18px;
      font-weight: bold;
  }

  .sair:hover {
      opacity: 0.8;
  }
</style>

<script>
  document.querySelector('.sair').addEventListener('click', function() {
      window.location.href = "HOME.html"; // Substitua com o caminho da sua p√°gina
  });
</script>
